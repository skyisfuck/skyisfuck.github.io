<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="big head,306647809@qq.com"><title>Centos7安装Xen · big head</title><meta name="description" content="1、安装xen12345678910111213141516171819202122232425262728293031# 1、下载安装xen源yum install centos-release-xen -y# 2、修改xen源sed -i &quot;s/enabled=1/enabled=0/g&quot; /e"><meta name="keywords" content="Hexo,HTML,CSS,android,Linux"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">big head</a></h3><div class="description"><p>随便写写</p></div></div></div><ul class="social-links"><li><a href="http://weibo.com/inoroorg"><i class="fa fa-weibo"></i></a></li><li><a href="http://github.com/skyisfuck"><i class="fa fa-github"></i></a></li></ul><!--.footer--><!--  a(target="_blank", href="/")--><!--    span Theme by --><!--  a(href="skyisfuck.github.io")  skyisfuck--><!--  span &--><!--  a(href="https://github.com/Ben02/hexo-theme-Anatole")  Ben--><!--  .by_farbox--><!--    a(href="skyisfuck", target="_blank") Proudly published with Hexo&#65281;--><script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><center><div class="powered-by"><i class="fa fa-user"></i><span id="busuanzi_container_site_uv">&nbsp; <span id="busuanzi_value_site_uv"></span>&nbsp;  &nbsp;   </span><i class="fa fa-eye"></i><span id="busuanzi_container_site_pv">&nbsp; <span id="busuanzi_value_site_pv"></span></span></div></center></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li><li><a href="/games">小游戏</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Centos7安装Xen</a></h3></div><div class="post-content"><h4 id="1、安装xen"><a href="#1、安装xen" class="headerlink" title="1、安装xen"></a>1、安装xen</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、下载安装xen源</span></span><br><span class="line">yum install centos-release-xen -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、修改xen源</span></span><br><span class="line">sed -i <span class="string">"s/enabled=1/enabled=0/g"</span> /etc/yum.repos.d/CentOS-Xen.repo</span><br><span class="line">sed -i <span class="string">"1,8s/\[centos-virt-xen.*\]/[centos-virt-xen]/"</span> /etc/yum.repos.d/CentOS-Xen.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、更新centos内核</span></span><br><span class="line">yum --enablerepo=centos-virt-xen -y update kernel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、安装xen</span></span><br><span class="line">yum --enablerepo=centos-virt-xen -y install xen</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、修改Dom0的内存大小,内存太小，开不了机</span></span><br><span class="line">vi /etc/default/grub</span><br><span class="line">GRUB_CMDLINE_XEN_DEFAULT=<span class="string">"dom0_mem=4096M,max:4096M cpuinfo com1=115200,8n1 ....."</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6、运行grub-bootxen.sh脚本，将xen添加到开机启动项中</span></span><br><span class="line">/bin/grub-bootxen.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7、重启进入xen系统</span></span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8、查看xen的信息，检查是否安装成功</span></span><br><span class="line">xl info</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9、关闭selinux 和 NetworkManager</span></span><br><span class="line">sed -i <span class="string">'s/^SELINUX=.*/SELINUX=disabled/'</span> /etc/selinux/config</span><br><span class="line">setenforce 0</span><br><span class="line">systemctl <span class="built_in">disable</span> NetworkManager</span><br><span class="line">systemctl stop NetworkManager</span><br></pre></td></tr></table></figure>
<h4 id="2、新建网桥设备"><a href="#2、新建网桥设备" class="headerlink" title="2、新建网桥设备"></a>2、新建网桥设备</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/sysconfig/network-scripts/</span><br><span class="line">cp ifcfg-eth0 ifcfg-br0 </span><br><span class="line"></span><br><span class="line">vi ifcfg-eth0</span><br><span class="line">	TYPE=Ethernet</span><br><span class="line">	BOOTPROTO=none</span><br><span class="line">	NAME=eth0</span><br><span class="line">	DEVICE=eth0</span><br><span class="line">	ONBOOT=yes</span><br><span class="line">	BRIDGE=br0</span><br><span class="line">	<span class="comment">#IPADDR=192.168.5.137</span></span><br><span class="line">	<span class="comment">#PREFIX=24</span></span><br><span class="line">	<span class="comment">#GATEWAY=192.168.5.2</span></span><br><span class="line">	<span class="comment">#DNS1=192.168.5.2</span></span><br><span class="line"></span><br><span class="line">vi ifcfg-br0</span><br><span class="line">	TYPE=Bridge</span><br><span class="line">	BOOTPROTO=none</span><br><span class="line">	NAME=br0</span><br><span class="line">	DEVICE=br0</span><br><span class="line">	ONBOOT=yes</span><br><span class="line">	IPADDR=192.168.5.137</span><br><span class="line">	PREFIX=24</span><br><span class="line">	GATEWAY=192.168.5.2</span><br><span class="line">	DNS1=192.168.5.2</span><br><span class="line">	STP=1</span><br><span class="line"></span><br><span class="line">systemctl restart network</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># brctl show </span></span><br><span class="line">bridge name	bridge id		STP enabled	interfaces</span><br><span class="line">br0		8000.000c29db5f75	yes		eth0</span><br></pre></td></tr></table></figure>
<h4 id="3、选用半虚拟化（PV）或-PV-on-HVM（PVHVM）-或-全虚拟化-HVM"><a href="#3、选用半虚拟化（PV）或-PV-on-HVM（PVHVM）-或-全虚拟化-HVM" class="headerlink" title="3、选用半虚拟化（PV）或 PV-on-HVM（PVHVM） 或 全虚拟化(HVM)"></a>3、选用半虚拟化（PV）或 PV-on-HVM（PVHVM） 或 全虚拟化(HVM)</h4><h6 id="PV-on-HVM（PVHVM）"><a href="#PV-on-HVM（PVHVM）" class="headerlink" title="PV-on-HVM（PVHVM）"></a>PV-on-HVM（PVHVM）</h6><p>这里有 <a href="https://wiki.xen.org/wiki/PV_on_HVM" target="_blank" rel="noopener">PV-on-HVM</a> 的详细讨论，及<a href="https://wiki.xen.org/wiki/Xen_Linux_PV_on_HVM_drivers" target="_blank" rel="noopener">实例</a>。简单来说，你只需在上述 HVM 配置文件加入 xen_platform_pci=1 便能采用 PVHVM。</p>
<h6 id="半虚拟化（PV）"><a href="#半虚拟化（PV）" class="headerlink" title="半虚拟化（PV）"></a>半虚拟化（PV）</h6><p><font color="red">CentOS-6 及 CentOS-7 的内核缺省是不兼容半虚拟化的。你可以在 DomU 内采用 Dom0 内核，并于安装完成后通过修改配置文件启用 PV。</font></p>
<p>要是你有意这样做，以下是一些注意事项：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.你 不能 进行缺省安装，因为 Xen PV 机器的开机分区不能采用 XFS 文件系统……这是 CentOS 的缺省值。请在 CentOS 安装程序内手动创建一个 ext4 的 /boot 分区。</span></span><br><span class="line"><span class="comment"># 2.切勿在 CentOS 安装程序内以 LVM 分区作为开机分区……请采用标准分区。</span></span><br><span class="line"><span class="comment"># 3.要是你完成了上述事情，你便能创建一个 PV 配置文件，然后以 PV 模式从该分区开机。下面是一个供 test.pv DomU 用的样例，名为 </span></span><br><span class="line">vi /etc/xen/config.d/test.pv.cfg</span><br><span class="line">	name = <span class="string">"test"</span></span><br><span class="line">	kernel = <span class="string">"/source/vmlinuz"</span></span><br><span class="line">	ramdisk = <span class="string">"/source/initrd.img"</span></span><br><span class="line">	<span class="comment">#bootloader = "/usr/lib64/xen/bin/pygrub"</span></span><br><span class="line">	memory = 2048</span><br><span class="line">	vcpus = 1</span><br><span class="line">	vif = [ <span class="string">'bridge=br0'</span> ]</span><br><span class="line">	disk = [ <span class="string">'/xen/disk/test.qcow2,qcow2,xvda,rw'</span> ]</span><br><span class="line">	on_reboot = <span class="string">"destroy"</span></span><br><span class="line">假如你遵从上述所有规则（以 xen dom0 内核替换 CentOS-7 安装的内核，/boot 禁用 xfs 文件系统，/boot 禁用 LVM，等……），</span><br><span class="line">该机器将会以 PV 模式引导。当然，由于碟盘是共享的，你可以 同时 运行 HVM 及 PV 实例。你也可单独执行它们。</span><br><span class="line"><span class="comment"># 4.创建镜像硬盘</span></span><br><span class="line">mkdir -p /xen/disk</span><br><span class="line">qemu-img create -f qcow2 /xen/disk/test.qcow2 10G</span><br><span class="line"><span class="comment"># 5.要引导你的 PV DomU，请用此指令：</span></span><br><span class="line">xl create -c /etc/xen/config.d/test.pv.cfg</span><br><span class="line"><span class="comment"># 6.根据提示安装完系统后，选择reboot</span></span><br><span class="line"><span class="comment"># 7.修改test.pv配置文件</span></span><br><span class="line">vi /etc/xen/config.d/test.pv.cfg</span><br><span class="line">	name = <span class="string">"test"</span></span><br><span class="line">	<span class="comment">#kernel = "/source/vmlinuz"</span></span><br><span class="line">	<span class="comment">#ramdisk = "/source/initrd.img"</span></span><br><span class="line">	bootloader = <span class="string">"/usr/lib64/xen/bin/pygrub"</span></span><br><span class="line">	memory = 2048</span><br><span class="line">	vcpus = 1</span><br><span class="line">	vif = [ <span class="string">'bridge=br0'</span> ]</span><br><span class="line">	disk = [ <span class="string">'/xen/disk/test.qcow2,qcow2,xvda,rw'</span> ]</span><br><span class="line">	<span class="comment">#on_reboot = "destroy"</span></span><br><span class="line"><span class="comment"># 8.启动进入系统</span></span><br><span class="line">xl cretae -c /etc/xen/config.d/test.pv.cfg</span><br></pre></td></tr></table></figure></p>
<h6 id="选用全虚拟化（HVM）"><a href="#选用全虚拟化（HVM）" class="headerlink" title="选用全虚拟化（HVM）"></a>选用全虚拟化（HVM）</h6><p><font color="green">参数详解可以man 5 xl.cfg</font><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全虚拟化的硬盘不能用qemu-img创建，大小显示有误，用dd创建</span></span><br><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/xen/disk/c6-x8664.img oflag=direct seek=10239 bs=1M count=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS-6配置文件</span></span><br><span class="line">vi /etc/xen/config.d/c6-x8664.hvm.cfg</span><br><span class="line"></span><br><span class="line">builder = <span class="string">"hvm"</span></span><br><span class="line">name = <span class="string">"c6-x8664.hvm"</span></span><br><span class="line">memory = 4096</span><br><span class="line">vcpus = 2</span><br><span class="line">serial=<span class="string">'pty'</span></span><br><span class="line">vif = [ <span class="string">'mac=00:16:3E:29:00:00,bridge=xenbr0'</span> ]</span><br><span class="line">disk = [ <span class="string">'phy:/dev/vg_c6xendom0/c68-x8664-hvm,xvda,rw'</span>, <span class="string">'file:/opt/isos/CentOS-6.8-x86_64-minimal.iso,xvdb:cdrom,r'</span> ]</span><br><span class="line">boot = <span class="string">"dc"</span></span><br><span class="line">sdl = 0</span><br><span class="line">vnc = 1</span><br><span class="line">vnclisten  = <span class="string">"192.168.0.9"</span></span><br><span class="line">vncdisplay = 0</span><br><span class="line">vncpasswd  = <span class="string">"supersecret"</span></span><br><span class="line">stdvga=1</span><br><span class="line">videoram = 64</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS-7配置文件</span></span><br><span class="line">vi etc/xen/config.d/c7-x8664.hvm.cfg</span><br><span class="line"></span><br><span class="line">builder = <span class="string">"hvm"</span></span><br><span class="line">name = <span class="string">"c7-x8664.hvm"</span></span><br><span class="line">memory = 4096</span><br><span class="line">vcpus = 2</span><br><span class="line">serial=<span class="string">'pty'</span></span><br><span class="line">vif = [ <span class="string">'mac=00:16:3E:29:00:01,bridge=xenbr0'</span> ]</span><br><span class="line">disk = [ <span class="string">'phy:/dev/vg_c6xendom0/c73-x8664-hvm,xvda,rw'</span>, <span class="string">'file:/opt/isos/CentOS-7-x86_64-Minimal-1611.iso,xvdb:cdrom,r'</span> ]</span><br><span class="line">boot = <span class="string">"dc"</span></span><br><span class="line">sdl = 0</span><br><span class="line">vnc = 1</span><br><span class="line">vnclisten  = <span class="string">"192.168.0.9"</span></span><br><span class="line">vncdisplay = 1</span><br><span class="line">vncpasswd  = <span class="string">"supersecret"</span></span><br><span class="line">stdvga=1</span><br><span class="line">videoram = 64</span><br></pre></td></tr></table></figure></p>
<ul>
<li>vnc listen 的 IP 地址是网桥的 IP，在此样例中为 192.168.0.9</li>
<li>boot 可用磁盘机（a）、硬盘（c）、网络（n）或光盘（d）……因此 dc 代表以光盘然后以硬盘开机。完成安装后我们会将它改为 boot=”c”</li>
<li>我们可利用 vnc 客端连接到 192.168.0.9:5900（centos-6）及 192.168.0.9:5901（centos-7）。</li>
<li>步骤同半虚拟化，安装完系统后把配置文件中的boot = “dc”改成boot = “c”</li>
</ul>
<h4 id="4、使用通用工具libvirtd来管理xen"><a href="#4、使用通用工具libvirtd来管理xen" class="headerlink" title="4、使用通用工具libvirtd来管理xen"></a>4、使用通用工具libvirtd来管理xen</h4><ul>
<li>virsh (CLI)</li>
<li>virt-manager (GUI) —&gt;可在xshell中使用，需要安装xmanager</li>
<li>virt-install (CLI) –&gt;创建虚拟机</li>
</ul>
<h6 id="virt-install安装系统"><a href="#virt-install安装系统" class="headerlink" title="virt-install安装系统"></a>virt-install安装系统</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、安装Libvirt</span></span><br><span class="line">yum --enablerepo=centos-virt-xen -y install libvirt libvirt-daemon-xen virt-install virt-manager</span><br><span class="line"><span class="comment"># 2、启动Libvirtd</span></span><br><span class="line">systemctl start libvirtd</span><br><span class="line">systemctl <span class="built_in">enable</span> libvirtd</span><br><span class="line"><span class="comment"># 3、创建虚拟机镜像目录</span></span><br><span class="line">mkdir -p /xen/disk</span><br><span class="line"><span class="comment"># 4、开始安装虚拟机</span></span><br><span class="line">virt-install --connect xen:/// --paravirt --name centos7 --ram 4096 --disk path=/xen/disk/centos7.img,size=10 --vcpus 2 --os-type linux --os-variant rhel7 --network bridge=br0 --graphics none --location <span class="string">'/home/centos/'</span> --extra-args <span class="string">'text console=com1 utf8 console=hvc0'</span></span><br><span class="line"><span class="comment"># --location 后面接的是iso镜像挂载点(可本地/nfs/http/ftp)</span></span><br></pre></td></tr></table></figure>
<h6 id="virt-manager安装系统"><a href="#virt-manager安装系统" class="headerlink" title="virt-manager安装系统"></a>virt-manager安装系统</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、在xshell命令行中输入virt-manager &amp; 开启图形化安装系统</span></span><br><span class="line">virt-manager &amp;</span><br></pre></td></tr></table></figure>
<h4 id="5、启动自制的linux系统-busybox-pv"><a href="#5、启动自制的linux系统-busybox-pv" class="headerlink" title="5、启动自制的linux系统 busybox(pv)"></a>5、启动自制的linux系统 busybox(pv)</h4><p>在配置busybox前，讲一下，相关的配置知识<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@node1 ~]<span class="comment"># uname -r</span></span><br><span class="line">4.9.75-30.el6.x86_64</span><br><span class="line">可以查看当前系统的内核版本</span><br><span class="line"></span><br><span class="line">[root@node1 ~]<span class="comment"># xl list</span></span><br><span class="line">Name                                        ID   Mem VCPUs  State   Time(s)</span><br><span class="line">Domain-0                                     0  1024     1     r-----     547.3</span><br><span class="line"></span><br><span class="line"><span class="comment">#xl list 可以查看显示Domain的相关信息</span></span><br><span class="line"></span><br><span class="line">关于xen虚拟机的状态</span><br><span class="line">    r: running</span><br><span class="line">    b: 阻塞</span><br><span class="line">    p: 暂停</span><br><span class="line">    s: 停止</span><br><span class="line">    c: 崩溃</span><br><span class="line">    d: dying,正在关闭中的过程中</span><br><span class="line"></span><br><span class="line">xm与xl启动DomU使用的配置文件略有不同； </span><br><span class="line">对于xl而言，其创建DomU使用的配置指令可通过man xl.cfg获取    </span><br><span class="line">常用指令：       </span><br><span class="line">    1.name : 域名称，必须是唯一的         </span><br><span class="line">    2.builder： 指明虚拟机的类型，generic表示pv,hvm表示hvm            </span><br><span class="line">    3.vcpus: 虚拟CPU个数</span><br><span class="line">	maxvcpus: 最大虚拟cpu个数</span><br><span class="line">	cpus: vcpu可运行于其上物理CPU列表             </span><br><span class="line">    4.memory=MBYTES: 内存大小</span><br><span class="line">	maxmem=MBYTES: 可以使用的最大内存空间              </span><br><span class="line">    5.on_poweroff: 指明关机时采取的action</span><br><span class="line">	destroy ,restart,preserve               </span><br><span class="line">    6.on_reboot=<span class="string">"ACTION"</span> : 指明重启时采取的action               </span><br><span class="line">    7.on_crash=<span class="string">"ACTION"</span>: 虚拟机崩溃时采取的action            </span><br><span class="line">    8.disk=[ <span class="string">"DISK_SPEC_STRING"</span>, <span class="string">"DISK_SPEC_STRING"</span>, ...]:  指明磁盘设备，列表</span><br><span class="line">    9.vif=[ <span class="string">"NET_SPEC_STRING"</span>, <span class="string">"NET_SPEC_STRING"</span>, ...]： 指明网络接口，列表           </span><br><span class="line">    10.vfb=[ <span class="string">"VFB_SPEC_STRING"</span>, <span class="string">"VFB_SPEC_STRING"</span>, ...]： 指明virtual frame buffer 显示图形界面，列表；</span><br><span class="line">    11.pci=[ <span class="string">"PCI_SPEC_STRING"</span>, <span class="string">"PCI_SPEC_STRING"</span>, ... ]： 指明pci设备接口</span><br><span class="line"></span><br><span class="line">PV模式专用指令：           </span><br><span class="line">    kernel=<span class="string">"PATHNAME"</span>: 内核文件路径；          </span><br><span class="line">    ramdisk=<span class="string">"PATHNAME"</span>：为kernel指定内核提供的ramdisk文件路径            </span><br><span class="line">    root=<span class="string">"STRING"</span>： 指明根文件系统          </span><br><span class="line">    extra=<span class="string">"STRING"</span> ：额外传递给内核引导时使用的参数 </span><br><span class="line">    bootloader=<span class="string">"PROGRAM"</span>：如果DomU使用自己的kernel及ramdisk,此时需要一个Dom0中的应用程序来实现bootloader功能；</span><br><span class="line"></span><br><span class="line">磁盘参数指定方式：           </span><br><span class="line">    [&lt;target&gt;,[&lt;format&gt;,[vdev],[&lt;access&gt;]]]]</span><br><span class="line"></span><br><span class="line">	tartet表示磁盘映像文件或设备文件路径</span><br><span class="line">	format表示磁盘格式，如果映像文件，有多种 格式，如raw,qcow2</span><br><span class="line">	vdev 此设备在DomU被识别为硬件设备类型，支持hd,sd[x],xvd[x]</span><br><span class="line">	access访问权限 </span><br><span class="line">	    ro,r : 只读</span><br><span class="line">	    rw,w ：读写                </span><br><span class="line">    disk=[<span class="string">"/images/xen/linux.img,raw,xvda,rw"</span>,]</span><br><span class="line"></span><br><span class="line">使用qemu-img管理磁盘映像</span><br><span class="line">create [-f fmt] [-o options] filename [size]        </span><br><span class="line">可创建sparse稀疏格式的磁盘映像文件</span><br></pre></td></tr></table></figure></p>
<h6 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">(1) 准备磁盘映像文件</span><br><span class="line">        qemu-img create -f raw -o size=2G  /images/xen/busybox.img</span><br><span class="line">        mke2fs -t ext2 busybox.img</span><br><span class="line">        mount -o /images/xen/busybox.img /mnt/</span><br><span class="line"></span><br><span class="line">(2) 提供根文件系统</span><br><span class="line">        编译busybox,并复制到busybox.img映像中</span><br><span class="line">            yum groupinstall -y <span class="string">"Development Tools"</span> <span class="string">"Server Platfrom Development"</span></span><br><span class="line">            yum install -y glibc-static    <span class="comment">#为了方便移值，安装glibc-static，不让它依赖其它库</span></span><br><span class="line">            wget https://busybox.net/downloads/busybox-1.22.1.tar.bz2</span><br><span class="line">            tar xf busybox-1.22.1.tar.bz2</span><br><span class="line">            <span class="built_in">cd</span> busybox-1.22.1</span><br><span class="line">            make menuconfig</span><br><span class="line">                <span class="comment">#   Busybox Settings  ---&gt;   Build Options  ---&gt;  [*] Build BusyBox as a static binary (no shared libs)</span></span><br><span class="line">            make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">        cp -a _install/* /mnt/</span><br><span class="line">        mkdir proc sys dev etc var boot home</span><br><span class="line"></span><br><span class="line">        到这里可以试一下</span><br><span class="line"></span><br><span class="line">        <span class="built_in">cd</span></span><br><span class="line">        chroot /mnt /bin/sh</span><br><span class="line"></span><br><span class="line">(3) 提供DomU配置文件</span><br><span class="line">        <span class="built_in">cd</span> /boot/</span><br><span class="line">        ln -s vmlinuz-2.6.32-431.el6.x86_64 vmlinuz</span><br><span class="line">        ln -s initramfs-2.6.32-431.el6.x86_64.img initramfs.img</span><br><span class="line">        <span class="built_in">cd</span> /etc/xen</span><br><span class="line">        cp xlexample.pvlinux busybox</span><br><span class="line">        vim busybox</span><br><span class="line">        更改如下项：</span><br><span class="line">                name = <span class="string">"busybox-001"</span></span><br><span class="line">                kernel = <span class="string">"/boot/vmlinuz"</span></span><br><span class="line">                ramdisk = <span class="string">"/boot/initramfs.img"</span></span><br><span class="line">                extra = <span class="string">"selinux=0 init=/bin/sh"</span></span><br><span class="line">                memory = 256</span><br><span class="line">                vcpus = 1</span><br><span class="line">                disk = [ <span class="string">'/images/xen/busybox.img,raw,xvda,rw'</span> ]</span><br><span class="line">                root = <span class="string">"/dev/xvda ro"</span></span><br><span class="line"></span><br><span class="line">(4) 启动实例：</span><br><span class="line">                xl -v create busybox -n</span><br><span class="line">                xl list</span><br><span class="line">                xl -v create busybox</span><br><span class="line">                xl console busybox-001</span><br><span class="line">                退出ctrl+]</span><br></pre></td></tr></table></figure>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-11-09</span><i class="fa fa-tag"></i><a class="tag" href="/tags/xen/" title="xen">xen </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,skyisfuck.github.io/2018/11/09/Centos7安装Xen/,big head,Centos7安装Xen,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/2018/11/09/Xshell调用linux图形终端/" title="Xshell调用linux图形终端">下一篇</a></li></ul></div><a id="comments"></a><div id="vcomments" style="margin:0 30px;"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/gh/xcss/valine@latest/dist/Valine.min.js?v=undefined"></script><script>var valine = new Valine({
  el:'#vcomments',
  notify:false || false, 
  verify:false|| false, 
  app_id:'uILvmzOCbHtRJCgWCCEoWNPx-gzGzoHsz',
  app_key:'r7WD847PyX9xg8ldEEHnr4o8',
  placeholder:'Today is good day!!!',
  path: window.location.pathname,
  avatar:'monsterid'
})</script></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/love.js"></script></body></html>